<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>傳說對決 — 指令菜單</title>
  <style>
    :root{
      --bg:#0b1020; --panel:#0f1724; --accent:#ff6b6b; --muted:#94a3b8; --glass: rgba(255,255,255,0.04);
      --font-sans: 'Noto Sans TC', system-ui, -apple-system, 'Segoe UI', Roboto, 'Helvetica Neue', Arial;
    }
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:linear-gradient(180deg,#071021 0%, #071622 60%);font-family:var(--font-sans);color:#e6eef8}
    .wrap{max-width:980px;margin:28px auto;padding:18px;display:grid;grid-template-columns:340px 1fr;gap:18px}
    .panel{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:14px;padding:16px;box-shadow:0 6px 18px rgba(2,6,23,0.6)}
    .left{min-height:480px}
    h1{font-size:20px;margin:0 0 8px}
    .subtitle{color:var(--muted);font-size:13px;margin-bottom:12px}
    .buttons{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    button.cmd{padding:14px;border-radius:10px;border:1px solid rgba(255,255,255,0.06);background:var(--glass);font-weight:700;font-size:14px;cursor:pointer;backdrop-filter: blur(4px)}
    button.cmd:active{transform:translateY(2px)}
    .count{font-size:12px;color:var(--muted);margin-top:6px}

    .right{min-height:480px;display:flex;flex-direction:column;justify-content:space-between}
    .display{height:340px;border-radius:12px;padding:18px;display:flex;flex-direction:column;align-items:center;justify-content:center;position:relative;overflow:hidden}
    .display .big{font-size:56px;font-weight:800;letter-spacing:1px}
    .display .small{font-size:16px;color:var(--muted);margin-top:8px}
    .recent{margin-top:12px;color:var(--muted);font-size:13px}

    .controls{display:flex;gap:10px;align-items:center}
    .controls input[type=checkbox]{width:18px;height:18px}
    .footer{font-size:12px;color:var(--muted);text-align:right}

    /* overlay animation */
    .cmd-overlay{position:absolute;left:50%;top:50%;transform:translate(-50%,-50%) scale(0.8);pointer-events:none;padding:22px 36px;border-radius:12px;background:linear-gradient(90deg, rgba(255,255,255,0.06), rgba(255,255,255,0.02));border:1px solid rgba(255,255,255,0.06);opacity:0;transition:all 360ms cubic-bezier(.2,.9,.3,1)}
    .cmd-overlay.show{opacity:1;transform:translate(-50%,-50%) scale(1);}
    .cmd-name{font-weight:900;font-size:28px}
    .cmd-desc{margin-top:6px;color:var(--muted)}

    /* responsive */
    @media (max-width:900px){.wrap{grid-template-columns:1fr}} 
  </style>
</head>
<body>
  <div class="wrap">
    <div class="panel left">
      <h1>傳說對決 指令菜單</h1>
      <div class="subtitle">讓觀眾點指令，顯示於直播畫面。可放入 OBS / TikTok Live Studio 的瀏覽器來源。</div>

      <div class="buttons" id="buttonGrid">
        <!-- buttons generated by JS -->
      </div>

      <div class="count" id="counts">總點擊：0</div>

      <hr style="border:none;height:12px;"> 

      <div style="margin-top:12px;font-size:13px;color:var(--muted)">
        使用說明：<br>
        1. 將此 HTML 上傳到可存取的網址或本機在 OBS 新增瀏覽器來源。<br>
        2. 觀眾可用外部連結或你口頭告知輸入編號來觸發（後續可串接聊天室機器人）。<br>
        3. 若要讓觀眾直接操作，可把頁面放在互動平台並允許投票/按鈕。
      </div>

    </div>

    <div class="panel right">
      <div>
        <div class="display" id="display">
          <div class="cmd-overlay" id="overlay">
            <div class="cmd-name" id="overlayName">攻擊左路</div>
            <div class="cmd-desc" id="overlayDesc">快點集合一起切後排！</div>
          </div>

          <div class="big" id="mainName">等待指令中</div>
          <div class="small" id="mainDesc">觀眾按下按鈕後會在這裡顯示指令</div>
        </div>

        <div class="recent" id="recent">最近：無</div>
      </div>

      <div>
        <div class="controls">
          <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="autoHide" checked>自動隱藏（3s）</label>
          <label style="display:flex;align-items:center;gap:8px"><input type="checkbox" id="showCount" checked>顯示點擊數</label>
          <button id="resetBtn" style="margin-left:auto;padding:8px 12px;border-radius:8px;background:transparent;border:1px solid rgba(255,255,255,0.06);cursor:pointer">重置</button>
        </div>
        <div class="footer" style="margin-top:10px">版本 1.0 • 直接使用於 OBS / 直播伴侶</div>
      </div>
    </div>
  </div>

  <script>
    // 指令清單（可自行新增或修改）
    const COMMANDS = [
      {id:1,name:'攻擊左路',desc:'優先集火塔下路敵人'},
      {id:2,name:'攻擊中路',desc:'跟著進中路推塔'},
      {id:3,name:'支援隊友',desc:'去支援最近呼救隊友'},
      {id:4,name:'控龍',desc:'準備控製河道資源'},
      {id:5,name:'撤退',desc:'全隊後撤保命'},
      {id:6,name:'埋伏',desc:'在草叢設陷阱'},
      {id:7,name:'優先刺客',desc:'讓刺客找機會切後排'},
      {id:8,name:'全員推線',desc:'集體推線逼塔'},
      {id:9,name:'大絕上去',desc:'技能連招，一波帶走'},
      {id:10,name:'抽獎/懲罰',desc:'抽一位觀眾決定懲罰'}
    ];

    const buttonGrid = document.getElementById('buttonGrid');
    const mainName = document.getElementById('mainName');
    const mainDesc = document.getElementById('mainDesc');
    const overlay = document.getElementById('overlay');
    const overlayName = document.getElementById('overlayName');
    const overlayDesc = document.getElementById('overlayDesc');
    const recent = document.getElementById('recent');
    const countsEl = document.getElementById('counts');

    let counts = {};
    let totalClicks = 0;

    function renderButtons(){
      buttonGrid.innerHTML = '';
      COMMANDS.forEach(c=>{
        counts[c.id] = counts[c.id]||0;
        const btn = document.createElement('button');
        btn.className = 'cmd';
        btn.innerHTML = `<div style="display:flex;justify-content:space-between;align-items:center"> <div style="text-align:left">${c.name}<div style="font-size:12px;color:var(--muted)">${c.desc}</div></div><div style="font-weight:800">#${c.id}</div></div>`;
        btn.addEventListener('click',()=>onCommand(c.id));
        buttonGrid.appendChild(btn);
      });
    }

    function onCommand(id){
      const cmd = COMMANDS.find(x=>x.id===id);
      if(!cmd) return;
      // update main display
      mainName.textContent = cmd.name;
      mainDesc.textContent = cmd.desc;
      // overlay anim
      overlayName.textContent = cmd.name;
      overlayDesc.textContent = cmd.desc;
      overlay.classList.remove('show');
      void overlay.offsetWidth;
      overlay.classList.add('show');

      // recent
      const time = new Date().toLocaleTimeString();
      recent.textContent = `最近：${cmd.name} • ${time}`;

      // counts
      counts[id] = (counts[id]||0)+1;
      totalClicks++;
      countsEl.textContent = `總點擊：${totalClicks}`;

      // auto hide
      if(document.getElementById('autoHide').checked){
        setTimeout(()=>{
          overlay.classList.remove('show');
        },3000);
      }

      // dispatch a custom event so OBS/外部可以接收（if using browser source with JS事件橋接）
      const e = new CustomEvent('cmdTriggered', {detail:{id:id,name:cmd.name,desc:cmd.desc,time:Date.now()}});
      window.dispatchEvent(e);
    }

    document.getElementById('resetBtn').addEventListener('click',()=>{
      counts = {};
      totalClicks = 0;
      countsEl.textContent = '總點擊：0';
      mainName.textContent = '等待指令中';
      mainDesc.textContent = '觀眾按下按鈕後會在這裡顯示指令';
      recent.textContent = '最近：無';
    });

    // allow triggering via URL param ?cmd=3 or via window.postMessage for chatbot/機器人整合
    function checkUrlCmd(){
      const params = new URLSearchParams(location.search);
      const cmd = parseInt(params.get('cmd'));
      if(cmd) onCommand(cmd);
    }

    // listen for postMessage from OBS/機器人
    window.addEventListener('message',(ev)=>{
      try{
        const data = typeof ev.data === 'string'? JSON.parse(ev.data):ev.data;
        if(data && data.cmdId) onCommand(Number(data.cmdId));
      }catch(e){}
    },false);

    // also accept custom event via window.triggerCommand({id:3})
    window.triggerCommand = function(obj){ if(obj && obj.id) onCommand(Number(obj.id)); }

    // init
    renderButtons();
    checkUrlCmd();

    // optional: expose state for debugging
    window.__AOV_CMD_STATE = {COMMANDS,counts};
  </script>
</body>
</html>
